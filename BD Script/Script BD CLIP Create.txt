USE ClipBank;

CREATE TABLE USUARIOS
(
DNI NVARCHAR(9) NOT NULL PRIMARY KEY,
NOMBRE NVARCHAR(50) NOT NULL,
APELLIDO NVARCHAR (50) NOT NULL,
NOMBRE_SITUACION_CREDITICIA NVARCHAR(50) NOT NULL,
NOMBRE_USUARIO NVARCHAR(50) UNIQUE NOT NULL,
EMAIL NVARCHAR(100)UNIQUE NOT NULL,
TELEFONO NVARCHAR (20),
CONTRASEÑA NVARCHAR(200) NOT NULL
)

CREATE TABLE CUENTAS
(
CVU NVARCHAR(22) NOT NULL PRIMARY KEY,
DNI_USUARIO NVARCHAR(9) NOT NULL,
SALDO NVARCHAR(20) NOT NULL,
DIVISA NVARCHAR(20),
TIPO_CUENTA NVARCHAR(40)NOT NULL,
)

CREATE TABLE SITUACIONES_CREDITICIAS
(
NOMBRE NVARCHAR(50) NOT NULL PRIMARY KEY,
DESCRIPCION NVARCHAR (200),
MONTO_DESCUBIERTO_PERMITIDO NVARCHAR(20) NOT NULL
)

CREATE TABLE OPERACIONES
(
ID_OPERACION INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
MONTO NVARCHAR(20) NOT NULL,
FECHA DATE NOT NULL,
CVU NVARCHAR(22) NOT NULL,
NOMBRE_TIPO_OPERACION NVARCHAR(20)NOT NULL
)

CREATE TABLE TIPOS_OPERACIONES
(
NOMBRE NVARCHAR(20) NOT NULL PRIMARY KEY,
DESCRIPCION NVARCHAR(200)
)

CREATE TABLE TRANSFERENCIAS
(
DATOS_OPERACION INT NOT NULL,
NUMERO_TRANSFERENCIA NVARCHAR(30) NOT NULL PRIMARY KEY,
CVU_CUENTA_DESTINO NVARCHAR(22) NOT NULL,
NOMBRE_CATEGORIA_TRANSFERENCIA NVARCHAR(30) NOT NULL,
CONCEPTO NVARCHAR(50) NOT NULL
)

CREATE TABLE CATEGORIAS_TRANSFERENCIAS
(
NOMBRE NVARCHAR(30) NOT NULL PRIMARY KEY,
DESCRIPCION NVARCHAR (100)
)

CREATE TABLE DIVISA
(
NOMBRE NVARCHAR(20) NOT NULL PRIMARY KEY,
TIPO_DIVISA NVARCHAR(20)
)

/* Aqui se declaran las FK  */

ALTER TABLE USUARIOS
ADD CONSTRAINT FK_NOMBRE_SITUACION_CREDITICIA
FOREIGN KEY (NOMBRE_SITUACION_CREDITICIA)
REFERENCES SITUACIONES_CREDITICIAS (NOMBRE);

ALTER TABLE CUENTAS
ADD CONSTRAINT FK_DNI_USUARIO
FOREIGN KEY (DNI_USUARIO)
REFERENCES USUARIOS (DNI);

ALTER TABLE OPERACIONES
ADD CONSTRAINT FK_CVU
FOREIGN KEY (CVU)
REFERENCES CUENTAS (CVU);

ALTER TABLE OPERACIONES
ADD CONSTRAINT FK_NOMBRE_TIPO_OPERACION
FOREIGN KEY (NOMBRE_TIPO_OPERACION)
REFERENCES TIPOS_OPERACIONES (NOMBRE);

ALTER TABLE TRANSFERENCIAS
ADD CONSTRAINT FK_CVU_CUENTA_DESTINO
FOREIGN KEY (CVU_CUENTA_DESTINO)
REFERENCES CUENTAS (CVU);

ALTER TABLE TRANSFERENCIAS
ADD CONSTRAINT FK_NOMBRE_CATEGORIA_TRANSFERENCIA
FOREIGN KEY (NOMBRE_CATEGORIA_TRANSFERENCIA)
REFERENCES CATEGORIAS_TRANSFERENCIAS (NOMBRE);

ALTER TABLE TRANSFERENCIAS
ADD CONSTRAINT FK_DATOS_OPERACION
FOREIGN KEY (DATOS_OPERACION)
REFERENCES OPERACIONES (ID_OPERACION);



/* INSERTS Tablas Sumidero */

INSERT INTO CATEGORIAS_TRANSFERENCIAS (NOMBRE, DESCRIPCION)
VALUES ('categoria1', 'descripcion1')

INSERT INTO CATEGORIAS_TRANSFERENCIAS (NOMBRE, DESCRIPCION)
VALUES ('categoria2', 'descripcion2')

INSERT INTO SITUACIONES_CREDITICIAS (NOMBRE, DESCRIPCION, MONTO_DESCUBIERTO_PERMITIDO)
VALUES ('normal', 'situacion optima', '3000')

INSERT INTO TIPOS_OPERACIONES (NOMBRE, DESCRIPCION)
VALUES ('transferencia', 'transferencia de dinero de una cuenta a otra cuenta')



/* INSERTS Tabla Usuario*/

INSERT INTO USUARIOS (DNI, NOMBRE, APELLIDO, NOMBRE_SITUACION_CREDITICIA, NOMBRE_USUARIO, EMAIL, TELEFONO, CONTRASEÑA)
VALUES ('12345678', 'hector', 'prueba', 'normal', 'hectorp', 'hectorprueba@gmail.com', '3516778244', 'hectorin22')

INSERT INTO USUARIOS (DNI, NOMBRE, APELLIDO, NOMBRE_SITUACION_CREDITICIA, NOMBRE_USUARIO, EMAIL, TELEFONO, CONTRASEÑA)
VALUES ('13243546', 'martin', 'prueba', 'normal', 'martinp', 'martinprueba@gmail.com', '3516984311', 'martinin77')